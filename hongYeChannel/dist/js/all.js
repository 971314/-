$(function(){function e(){var e=$("#nameNo").val().trim();return e?void $.ajax({url:serverIP+channelUrl,type:"post",data:JSON.stringify({func:fetchChannelCode,data:{recommenderName:e}}),contentType:"application/json",crossDomain:!0,success:function(e){console.log(e),0==e.retHead?e.data.result.length>0&&(o=e.data.result[0].CHANNEL_ID,s=e.data.result[0].CHANNEL_NAM,t=!0,console.log(s),console.log(o),sessionStorage.setItem("userName",s),sessionStorage.setItem("channelID",o),n()):$("#flagUserDialog").modal(flagUserDialog)},error:function(e){console.log("服务器异常！")}}):($("#errorMsg").css("display","block"),void $("#errorMsg").html("输入有误！"))}function n(){$.ajax({url:serverIP+channelUrl,type:"post",data:JSON.stringify({func:fetchTwoQr,data:{length:twoQrSize,url:serverIP+shareUrl+o}}),contentType:"application/json",crossDomain:!0,success:function(e){0==e.retHead&&(sessionStorage.setItem("TwoQr",e.data),window.location.href="view/createQrCode.html")},error:function(e){console.log("服务器异常！")}})}var o,s,t=!1;$("#nextBtn").click(function(){e()}),$("#nextBtn").blur(function(){$("#errorMsg").css("display","none")}),$("#sysTitle").html(companyName+"渠道管理系统")});var phoneRegexp=/^(13|15|18|14|17)[0-9]{9}$/,channelUrl="/PbChannelManagement/WebService",version="1.0.0",fetchChannelCode=1,fetchTwoQr=2,regiter=3,verify=4,twoQrSize="132",shareUrl="/PbChannel/view/remmendThree.html?channelid=";$(function(){}),$(function(){function e(){var e=$("#phone").val().trim();if(""==c)return $("#remmendMsg").css("display","block"),void $("#remmendMsg").html("当前操作系统未知");for(var n=60,o=0;o<=60;o++)window.setTimeout(function(){0!=n?($("#countDown").show(),$("#countDown").html(n+"秒后重发"),$("#fetchCodeMsg").hide(),n--):(n=60,$("#fetchCodeMsg").show(),$("#countDown").hide())},1e3*o);$.ajax({url:serverIP+channelUrl,type:"post",data:JSON.stringify({func:regiter,data:{loginName:e,os:c,version:version}}),contentType:"application/json",crossDomain:!0,success:function(n){0==n.retHead?(console.log(n.data),0==n.data.returnFlag?(l=1,i=n.data.loginName,r=n.data.userId,a=(i+"").substr(5,6),sessionStorage.setItem("loginName",i),sessionStorage.setItem("loginPwd",a)):6==n.data.returnFlag?($("dialogContent").html("发送验证码失败"),$("#flagLoginDialog").modal(flagLoginDialog),$("#fetchCodeMsg").show(),$("#countDown").hide()):(l=0,sessionStorage.setItem("loginName",e),sessionStorage.setItem("loginPwd","如忘记密码请在App中找回"),$("dialogContent").html("您已是注册用户"),$("#flagLoginDialog").modal(flagLoginDialog),$("#existLoginClose").click(function(){window.setTimeout(function(){window.location.href="suc.html"},1e3)}))):console.log(n)},error:function(e){console.log("服务器异常！")}})}function n(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(n);return null!=o?unescape(o[2]):null}function o(e,o,s){var t=n("channelid"),i=$("#codeMsg").val().trim();$.ajax({url:serverIP+channelUrl,type:"post",data:JSON.stringify({func:verify,data:{loginName:e,pwd:o,otp:i,os:c,uid:s,channelNumber:t}}),contentType:"application/json",crossDomain:!0,success:function(n){0==n.retHead?(console.log(n),8==n.data.returnFlag?(alert("校验码不对"),console.log("校验码不对")):(sessionStorage.setItem("loginName",e),sessionStorage.setItem("loginPwd",o),window.location.href="suc.html")):(console.log("请求异常"),console.log(n))}})}function s(){var e=navigator.userAgent;return console.log(e),e.indexOf("MicroMessenger")>-1?"WeiXin":e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"Android":e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1?"IOS":e.indexOf("Windows Phone")>-1?"Windows":(console.log(e),console.log("当前操作系统未知"),"")}function t(){return"WeiXin"!=c||($("#regInfo1").css("display","none"),$("#regInfo2").css("display","none"),$("#remmendBtn").css("display","none"),$("#remmendMsg").css("font-size","18px"),$("#remmendMsg").css("display","block"),$("#remmendMsg").html("当前不支持微信打开下载，请选择其它浏览器扫描打开"),!1)}var i,r,a,l=0,c=s();$("#sysTitleReg").html(companyName+"手机客户"),$("#remmendBtn").click(function(){if(t()){var e=$("#phone").val(),n=$("#codeMsg").val();return e?phoneRegexp.test(e)?n?void(l&&(a=e.substr(5,6),i=e,o(i,a,r))):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入验证码！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请正确输入手机号！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入手机号！"))}}),$("#remmendBtn").blur(function(){$("#remmendMsg").css("display","none")}),$("#fetchCodeMsg").click(function(){if(t()){var n=$("#phone").val();return n?phoneRegexp.test(n)?void e():($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请正确输入手机号！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入手机号！"))}}),t();var d=$(window).height();$(".inputText").focus(function(){$(".divBgImg").css("height",d+50)}),$(".inputText").blur(function(){$(".divBgImg").css("height",d),$(".divBgImg").scrollTop(0)})});