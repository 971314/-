$(function(){function e(){$.ajax({url:serverIP+randomCodeUrl+(new Date).getTime(),type:"GET",crossDomain:!0,success:function(e){0==e.retHead&&($("#randomCodeImg").attr("src","data:image/jpg;base64,"+e.data.image),r=e.data.id)},error:function(e){console.error("服务器异常！")}})}function o(){var e="test",o=window.localStorage;try{return o.setItem(e,"testValue"),o.removeItem(e),!0}catch(e){return!1}}function n(){function o(){for(var e=60,o=0;o<=60;o++)window.setTimeout(function(){0!=e?($("#countDown").show(),$("#countDown").html(e+"秒后重发"),$("#fetchCodeMsg").hide(),e--):(e=60,$("#fetchCodeMsg").show(),$("#countDown").hide())},1e3*o)}var n=$("#phone").val().trim(),t=$("#randomCode").val().trim();return""==f?($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("当前操作系统未知")):void $.ajax({url:serverIP+channelUrl,type:"POST",data:JSON.stringify({func:regiter,data:{loginName:n,os:f,version:version,codeId:r,code:t}}),contentType:"application/json",crossDomain:!0,success:function(t){o(),0==t.retHead?(console.log(t.data),0==t.data.returnFlag?(u=1,c=t.data.loginName,m=t.data.userId,g=(c+"").substr(5,6)):6==t.data.returnFlag?($("#dialogContent").html("发送短信验证码失败"),e(),$("#randomCode").val(""),$("#flagLoginDialog").modal(flagLoginDialog),$("#fetchCodeMsg").show(),$("#countDown").hide()):5==t.data.returnFlag?(u=0,$("#dialogContent").html("您已是注册用户"),e(),$("#randomCode").val(""),$("#flagLoginDialog").modal(flagLoginDialog),$("#existLoginClose").click(function(){window.setTimeout(function(){window.location.href="suc.html?name="+n+"&pwd=0&id="+d},1e3)})):($("#dialogContent").html(t.data.loginName),e(),$("#randomCode").val(""),$("#flagLoginDialog").modal(flagLoginDialog),$("#fetchCodeMsg").show(),$("#countDown").hide())):console.log(t)},error:function(e){console.log("服务器异常！")}})}function t(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(o);return null!=n?unescape(n[2]):null}function i(o,n,i){var a=t("channelid"),s=$("#codeMsg").val().trim();$.ajax({url:serverIP+channelUrl,type:"POST",data:JSON.stringify({func:verify,data:{loginName:o,pwd:n,otp:s,os:f,uid:i,channelNumber:a}}),contentType:"application/json",crossDomain:!0,success:function(n){0==n.retHead?(console.log(n),8==n.data.returnFlag?(e(),$("#randomCode").val(""),alert("校验码不对"),console.log("校验码不对")):window.location.href="suc.html?name="+o+"&pwd=1&id="+a):(console.log("请求异常"),console.log(n))}})}function a(){var e=navigator.userAgent;return console.log(e),e.indexOf("MicroMessenger")>-1?"WeiXin":e.indexOf("Android")>-1||e.indexOf("Linux")>-1?"Android":e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1?"IOS":e.indexOf("Windows Phone")>-1?"Windows":(console.log("当前操作系统未知"),"Android")}function s(){return"WeiXin"!=f||($("#regInfo1").css("display","none"),$("#regInfo2").css("display","none"),$("#remmendBtn").css("display","none"),$("#remmendMsg").css("font-size","18px"),$("#remmendMsg").css("display","block"),$("#root").attr("class",""),$("html").css("background-color","#514F4A"),$("#root").html("<img src='../images/bgweixin.png' width='100%'' style='position:absolute;left:0;top:0'>"),$(document).attr("title","App下载"),!1)}var r;e(),$("#randomCodeImg").click(e);var d=t("channelid"),l=localStorage.getItem("guid");l||(l=(new GUID).newGUID(),o()&&localStorage.setItem("guid",l)),$.ajax({url:serverIP+channelUrl,type:"POST",data:JSON.stringify({func:visits,data:{codeId:l,channelNumber:d}}),contentType:"application/json",crossDomain:!0,success:function(e){console.log("success")},error:function(e){console.error("统计访问量失败")}});var c,m,g,u=0,f=a();$("#sysTitleReg").html(companyName+"手机App"),$("#remmendBtn").click(function(){if(s()){var e=$("#phone").val().trim(),o=$("#randomCode").val().trim(),n=$("#codeMsg").val().trim();return e?phoneRegexp.test(e)?o?n?void(u&&(g=e.substr(5,6),c=e,i(c,g,m))):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入短信验证码！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入图形验证码！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请正确输入手机号！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入手机号！"))}}),$("#remmendBtn").blur(function(){$("#remmendMsg").css("display","none")}),$("#fetchCodeMsg").click(function(){if(s()){var e=$("#phone").val().trim(),o=$("#randomCode").val().trim();return e?phoneRegexp.test(e)?o?void n():($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入图形验证码！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请正确输入手机号！")):($("#remmendMsg").css("display","block"),void $("#remmendMsg").html("请输入手机号！"))}}),s();var h=$(window).height();$(".inputText").focus(function(){$(".divBgImg").css("height",h+50)}),$(".inputText").blur(function(){$(".divBgImg").css("height",h),$(".divBgImg").scrollTop(0)})});